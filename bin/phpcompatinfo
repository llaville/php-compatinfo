#!/usr/bin/env php
<?php
$appName = 'phpCompatInfo';

if (\Phar::running()) {
    $vendorDir = 'phar://' . strtolower($appName) . '.phar/vendor';
} else {
    $baseDir   = dirname(__DIR__);
    $vendorDir = $baseDir . '/vendor';

    if (!file_exists($vendorDir . '/autoload.php')) {
        $vendorDir = dirname(dirname($baseDir));
    }

    if (!getenv("BARTLETTRC")) {
        putenv("BARTLETTRC=" . strtolower($appName) . '.json');
    }
}
$loader = require_once $vendorDir . '/autoload.php';
$loader->setUseIncludePath(true);

if (PHP_SAPI !== 'cli') {
    return;
}

$compatInfoDbV1 = class_exists(Bartlett\CompatInfoDb\Environment::class);

if (\Phar::running() && $compatInfoDbV1) {
    try {
        Bartlett\CompatInfoDb\Environment::checkRequirements();
    } catch (\RuntimeException $e) {
        die ($e->getMessage());
    }
}

use Bartlett\Reflect\Environment;
use Bartlett\CompatInfo\Console\Application;

Environment::setScanDir();

$application = new Application($appName, '5.2.2');
$application->run();
