---
name: Release

on:
    push:
        branches:
            - "[0-9]+.[0-9]+"
        tags:
            - "[0-9]+.[0-9]+.[0-9]+"
    workflow_dispatch:

jobs:
    tests:
        uses: ./.github/workflows/unit-tests.yaml

    build:
        needs: tests

        name: Create Release
        uses: llaville/.github/.github/workflows/release.yml@master
        with:
            repository: ${{ github.repository }}
            box-output: bin/phpcompatinfo.phar
            release-draft: true
            release-prerelease: ${{ github.ref_type == 'branch' }}
            legacy: false
            changie-changesDir: ".changes/7.x"
            changie-command-args: "batch --keep --prerelease snapshot major"
